"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const User_1 = __importDefault(global[Symbol.for('ioc.use')]("App/Models/User"));
const RegisterUserValidator_1 = __importDefault(require("../../Validators/RegisterUserValidator"));
class AuthController {
    async register({ request }) {
        const data = await request.validate(RegisterUserValidator_1.default);
        const user = await User_1.default.create(data);
        return user;
    }
    async login({ request, auth, response }) {
        try {
            const { email, password } = request.all();
            const token = await auth.use('api').attempt(email, password, {
                expiresIn: '1day'
            });
            const user = await User_1.default.findByOrFail("email", email);
            return { token, user };
        }
        catch (error) {
            response.status(401).send("login ou senha incorretos!");
        }
    }
}
exports.default = AuthController;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXV0aENvbnRyb2xsZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJBdXRoQ29udHJvbGxlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUNBLGlGQUFrQztBQUNsQyxtR0FBMEU7QUFFMUUsTUFBcUIsY0FBYztJQUN4QixLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsT0FBTyxFQUF1QjtRQUNsRCxNQUFNLElBQUksR0FBRyxNQUFNLE9BQU8sQ0FBQyxRQUFRLENBQUMsK0JBQXFCLENBQUMsQ0FBQTtRQUMxRCxNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDcEMsT0FBTyxJQUFJLENBQUE7SUFDZixDQUFDO0lBQ00sS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUF1QjtRQUMvRCxJQUFJO1lBQ0EsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUE7WUFDekMsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFO2dCQUN6RCxTQUFTLEVBQUUsTUFBTTthQUNwQixDQUFDLENBQUE7WUFDRixNQUFNLElBQUksR0FBRyxNQUFNLGNBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFBO1lBQ3BELE9BQU8sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUE7U0FDekI7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNaLFFBQVEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUE7U0FDMUQ7SUFDTCxDQUFDO0NBQ0o7QUFsQkQsaUNBa0JDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBIdHRwQ29udGV4dENvbnRyYWN0IH0gZnJvbSAnQGlvYzpBZG9uaXMvQ29yZS9IdHRwQ29udGV4dCdcbmltcG9ydCBVc2VyIGZyb20gJ0FwcC9Nb2RlbHMvVXNlcidcbmltcG9ydCBSZWdpc3RlclVzZXJWYWxpZGF0b3IgZnJvbSAnLi4vLi4vVmFsaWRhdG9ycy9SZWdpc3RlclVzZXJWYWxpZGF0b3InXG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEF1dGhDb250cm9sbGVyIHtcbiAgICBwdWJsaWMgYXN5bmMgcmVnaXN0ZXIoeyByZXF1ZXN0IH06IEh0dHBDb250ZXh0Q29udHJhY3QpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlcXVlc3QudmFsaWRhdGUoUmVnaXN0ZXJVc2VyVmFsaWRhdG9yKVxuICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5jcmVhdGUoZGF0YSlcbiAgICAgICAgcmV0dXJuIHVzZXJcbiAgICB9XG4gICAgcHVibGljIGFzeW5jIGxvZ2luKHsgcmVxdWVzdCwgYXV0aCwgcmVzcG9uc2UgfTogSHR0cENvbnRleHRDb250cmFjdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgeyBlbWFpbCwgcGFzc3dvcmQgfSA9IHJlcXVlc3QuYWxsKClcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gYXdhaXQgYXV0aC51c2UoJ2FwaScpLmF0dGVtcHQoZW1haWwsIHBhc3N3b3JkLCB7XG4gICAgICAgICAgICAgICAgZXhwaXJlc0luOiAnMWRheSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kQnlPckZhaWwoXCJlbWFpbFwiLCBlbWFpbClcbiAgICAgICAgICAgIHJldHVybiB7IHRva2VuLCB1c2VyIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDEpLnNlbmQoXCJsb2dpbiBvdSBzZW5oYSBpbmNvcnJldG9zIVwiKVxuICAgICAgICB9XG4gICAgfVxufVxuXG4iXX0=